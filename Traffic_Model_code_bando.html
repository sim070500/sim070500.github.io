<!DOCTYPE html>
<html lang="en">

<head>

    <!-- Basic Page Needs
    ================================================== -->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Traffic Model | EJ Blog</title>

    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">

    <!-- Mobile Specific Metas
    ================================================== -->
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,300i,400,600,700" rel="stylesheet">
    <script src="https://kit.fontawesome.com/018abb2f7f.js" crossorigin="anonymous"></script>

    <!-- Favicon
    ================================================== -->
    <link rel="apple-touch-icon" sizes="180x180" href="assets/img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/img/favicon.png">

    <!-- Stylesheets
    ================================================== -->
    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="assets/css/style.css" rel="stylesheet">
    <link href="assets/css/responsive.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
        inlineMath: [['$','$']]
      }
    });
  </script>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
        type="text/javascript"></script>

</head>

<body>

    <header id="masthead" class="site-header site-header-white">
        <nav id="primary-navigation" class="site-navigation">
            <div class="container">



                <div class="navbar-header">

                    <a class="site-title"><span>EJ Blog</span>- Exploring in complex system</a>

                </div><!-- /.navbar-header -->

                <div class="collapse navbar-collapse" id="agency-navbar-collapse">

                    <ul class="nav navbar-nav navbar-right">


                        <li><a href="index.html">Home</a></li>

                        <li><a href="profile.html">Profile</a></li>
                        <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Researches<i
                                    class="fa fa-caret-down hidden-xs" aria-hidden="true"></i></a>

                            <ul class="dropdown-menu" role="menu" aria-labelledby="menu1">
                                <li><a href="Traffic_Model.html">Traffic Model</a></li>
                                <li><a href="Tumor_Morphology.html">Tumor Morphology</a></li>
                                <!--<li><a href="MIPS.html">Motility Induced Phase Seperation</a></li>-->

                            </ul>

                        </li>

                        <li><a href="Publication.html">Publication</a></li>



                    </ul>

                </div>

            </div>
        </nav><!-- /.site-navigation -->
    </header><!-- /#mastheaed -->

    <div id="hero" class="hero overlay subpage-hero portfolio-hero-traffic">
        <div class="hero-content">
            <div class="hero-text">
                <h1>Traffic Model</h1>
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                    <li class="breadcrumb-item active">Traffic Model</li>
                </ol>
            </div><!-- /.hero-text -->
        </div><!-- /.hero-content -->
    </div><!-- /.hero -->

    <main id="main" class="site-main">
        <section class="site-section subpage-site-section section-portfolio" style="background-color: #FFFFFF">
            <div class="container">
                <ul class="portfolio-sorting list-inline text-center">
                    <li><a href="Traffic_Model.html" class="btn btn-gray" data-group="introduction">Introduction</a>
                    </li>
                    <li><a href="Traffic_Model_code_bando.html" class="btn btn-gray"
                            data-group="codeidentical">Code-Bando Model</a></li>
                    <li><a href="./Traffic_Model_individual.html" class="btn btn-gray"
                            data-group="individual">Individual Difference</a></li>
                    <li><a href="./Traffic_Model_code_individual.html" class="btn btn-gray"
                            data-group="codeindividual">Code-Individual</a></li>
                </ul><!-- /.portfolio-sorting  -->




                <div class="row">
                    <div style="padding: 10px 0px;"></div>
                    <div class="text-center">
                        <h2 class="heading-separator">Simulation For Bando's Model</h2>
                        <p class="subheading-text"> Introduction of simulation for bando's model
                        </p>
                    </div>

                </div>
                <div class="row">
                    <div style="padding: 10px 0px;"></div>
                    <div class="col-sm-1"></div>
                    <div class="col-sm-10">
                        <p style="font-size:130%; color: black; line-height:130%">These are the jupyter-notebook code we present here and the complete python code for finding other properties.</p>

                        <div style="padding: 8px 0px;"></div>
                        <ul>
                            <li><b>jupyter-notebook code</b>
                                <a class="downloadfile-bg" href="Traffic/jupytercode.ipynb"
                                    download="traffic_bando.ipynb" target="_blank"><i class="fa fa-file"></i></a>
                            </li>
                            <li><b>python code</b>
                                <a  href="Traffic/bando_model.py"
                                    download="traffic_bando.ipynb" target="_blank"><i class="fa-brands fa-python"></i></a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="row">

                    <div style="padding:10px 0px;"></div>

                    <div class="col-sm-1"></div>
                    <div class="col-sm-10">
                        <p style="font-size:150%; color: black; line-height:130%" class="align-distribute">

                            <span class="tab"></span>In this page, I will introduce how to simply write a code to
                            simulate traffic flow. Assume that each vehicle is only a point in the simulation. Two
                            crucial information that we care about are the positions and the velocities of these
                            vehicles. To simulate these values, we need to import two useful packages in python:
                            <b><u>numpy</u></b>
                            and <b><u>matplotlib</u></b>. Numpy is a very useful package providing quick and precise
                            <b><u>scientific
                                    simulation</u></b>. Matplotlib is a useful package to <b><u>visualize</u></b> the
                            data from your simulation. To be
                            more specific, we do not import all matplotlib package, we only import the class pyplot,
                            which is enough to process data, in matplotlib. Since typing all package name every time
                            when we need the package wastes a lot of time, we can give them <b><u>nicknames</u></b> to
                            simplify them.
                            Common nicknames for numpy and matplotlib.pyplot are np and plt, respectively.
                        </p>
                    </div>
                </div>


                <div class="row">

                    <div style="padding:10px 0px;"></div>

                    <div class="col-sm-1"></div>
                    <div class="col-sm-10">
                        <pre>import numpy as np
import matplotlib.pyplot as plt</pre>
                    </div>
                </div>

                <div class="row">

                    <div style="padding:10px 0px;"></div>

                    <div class="col-sm-1"></div>
                    <div class="col-sm-10">
                        <p style="font-size:150%; color: black; line-height:130%" class="align-distribute">

                            <span class="tab"></span>Next, we define two variables: "totalcarn" and "length", which
                            specify
                            the number of vehicles on the track and the length of the track. In this case, the total
                            vehicle number is defined as 32. Since the track we are investigating is a circular one, the
                            radius can be quickly found and be defined as variable "r". Moreover, because we plan to
                            investigate the condition that a steady flow transits to traffic jam, the initial condition
                            will be set such that the angular differences between vehicles are the same. The constant
                            angular difference is defined as "alpha". The variable background, fig, and ax are used for
                            plotting background track and plotting.
                        </p>
                    </div>
                </div>

                <div class="row">

                    <div style="padding:10px 0px;"></div>

                    <div class="col-sm-1"></div>
                    <div class="col-sm-10">
                        <pre>totalcarn = 2**5
length = totalcarn*6
r = length/(2*np.pi)
alpha = 2*np.pi/totalcarn 
background = np.linspace(0, 2*np.pi, 100)
fig, ax = plt.subplots()</pre>
                    </div>
                </div>

                <div class="row">

                    <div style="padding:10px 0px;"></div>

                    <div class="col-sm-1"></div>
                    <div class="col-sm-10">
                        <p style="font-size:150%; color: black; line-height:130%" class="align-distribute">

                            <span class="tab"></span>Now, since the acceleration of each vehicles depends on the
                            inter-vehicle distance, we define a function for calculating it. The first step is find the
                            difference of positions that are stored in numpy array. Thus, we call "diff" function, which
                            return the value of [function[1]-function[0], function[2]-function[1], ... ]. However, the
                            difference will not calculate the inter-vehicle distance between the final vehicle and the
                            first one. Therefore, we need to expend it into the difference array.
                        </p>
                    </div>
                </div>

                <div class="row">

                    <div style="padding:10px 0px;"></div>

                    <div class="col-sm-1"></div>
                    <div class="col-sm-10">

                        <pre>def deltaxfunction(length, function):    

    delta = np.diff(function)
    delta = np.append(delta, function[0]+length-function[-1])
  
    return delta</pre>
                    </div>
                </div>
                <div class="row">

                    <div style="padding:10px 0px;"></div>

                    <div class="col-sm-1"></div>
                    <div class="col-sm-10">
                        <p style="font-size:150%; color: black; line-height:130%" class="align-distribute">

                            <span class="tab"></span>Finally, we can start our simulations. The first few lines are use
                            for defining the initial condition, which is the positions of vehicles that are equally
                            distributed on the track and add a small perturbation. The equally distributed position is initially defined as "x" and the perturbation we used here is a sin function. The only thing we need to notice is that the perturbation should not be too large since we applied linear perturbation in our analysis. The initial velocity is set to be ideal,
                            which means all drivers drive with their desired velocity, and since the vehicles are
                            initially equally distributed, all velocities are the same. Theoretically, the jamming
                            transition of the system is when
                            $$
                            \tau = \frac{1}{2}\left(\frac{dv_{\text{opt}}(\Delta x)}{d\Delta x}\right)\Bigg|_{\Delta x =
                            L/N} \equiv \frac{1}{\text{sense}}.
                            $$
                            Thus, the ideal sense is defined, and everyone can tune the coefficient such that the sense
                            is different from its ideal value.
                        </p>
                        <p style="font-size:150%; color: black; line-height:130%" class="align-distribute">

                            <span class="tab"></span>During the simulation, we apply two simulation method. The first
                            one is used for finding the optimal iteration time step. The reason for using this method is
                            that using a fixed time step might cause the collision between two vehicles when they are
                            too close to each other. Therefore, in each iteration, we use 0.01 times the minimal value
                            of inter-vehicle distances divided by their velocities as the iteration time step. By doing
                            so, all vehicles can not collide with each other. The other simulation method is the common
                            fourth-order Runge-Kutta (See <a
                                href="https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods" target="_blank"
                                style="text-decoration:none;color:blue;">Wikipidia</a> for detail).
                        </p>
                    </div>
                </div>

                <div class="row">

                    <div style="padding:10px 0px;"></div>

                    <div class="col-sm-1"></div>
                    <div class="col-sm-10">

                        <pre>x = np.linspace(0, length, totalcarn, endpoint=False)
idealdeltax = x[1]-x[0]
v = np.full(totalcarn, np.tanh(idealdeltax-2)+np.tanh(2))
theorysense = 2*(1/np.cosh(np.array(idealdeltax)-2)**2)/(np.cos(alpha/2)**2)
simulationtime = 0
coefficient = -0.01
sense = theorysense + coefficient
perturbe = 0.001*np.sin(x)

x = x+perturbe
while simulationtime < 600000:

    deltax = deltaxfunction(length, x)
    dt = np.min(deltax/v)*0.01
    
    k1x = v
    k1v = sense * (np.tanh(deltax-2)+np.tanh(2) - v)
    k2x = v + (dt * k1v * 0.5)
    k2v = sense * (np.tanh(deltaxfunction(length, x+(0.5*dt*k1x))-2)+np.tanh(2) - (v+(0.5*dt*k1v)))
    k3x = v + (dt * k2v * 0.5)
    k3v = sense * (np.tanh(deltaxfunction(length, x+(0.5*dt*k2x))-2)+np.tanh(2) - (v+(0.5*dt*k2v)))
    k4x = v + (dt * k3v)
    k4v = sense * (np.tanh(deltaxfunction(length, x+(dt*k3x))-2)+np.tanh(2) - (v+(dt*k3v)))

    x += dt*(k1x+2*k2x+2*k3x+k4x)/6
    v += dt*(k1v+2*k2v+2*k3v+k4v)/6
    
    simulationtime += 1</pre>
                    </div>
                </div>
		<div class="row">

                    <div style="padding:10px 0px;"></div>

                    <div class="col-sm-1"></div>
                    <div class="col-sm-10">
                        <p style="font-size:150%; color: black; line-height:130%" class="align-distribute">

                            <span class="tab"></span>Finally, we can start our simulations. The first few lines are use
                            for defining the initial condition, which is the positions of vehicles that are equally
                            distributed on the track, and be defined as "x". The initial velocity is set to be ideal,
                            which means all drivers drive with their desired velocity, and since the vehicles are
                            initially equally distributed, all velocities are the same. Theoretically, the jamming
                            transition of the system is when
                            $$
                            \tau = \frac{1}{2}\left(\frac{dv_{\text{opt}}(\Delta x)}{d\Delta x}\right)\Bigg|_{\Delta x =
                            L/N} \equiv \frac{1}{\text{sense}}.
                            $$
                            Thus, the ideal sense is defined, and everyone can tune the coefficient such that the sense
                            is different from its ideal value.
                        </p>
                        <p style="font-size:150%; color: black; line-height:130%" class="align-distribute">

                            <span class="tab"></span>Now, we can plot out our results by matplotlib. The first line is the plot for background track. The other is the plot for all vehicles.
                        </p>
                    </div>
                </div>
		<div class="row">

                    <div style="padding:10px 0px;"></div>

                    <div class="col-sm-1"></div>
                    <div class="col-sm-10">

                        <pre>
ax.plot(r*np.cos(background), r*np.sin(background), 'b-')
ax.plot(r*np.cos(theta), r*np.sin(theta), color='r', marker = 'o', linestyle='None')
plt.show()</pre>
                    </div>
                </div>
		<div class="row">

                    <div style="padding:10px 0px;"></div>

                    <div class="col-sm-1"></div>
                    <div class="col-sm-10">
                        <p style="font-size:150%; color: black; line-height:130%" class="align-distribute">

                            <span class="tab"></span> The final result is shown as the following figure
			    <figure class="text-center">
			    <img src="./Traffic/plot_600000.png" width="550" height="400" />
                            <figcaption>Fig.1 - Traffic Jam</figcaption>
                        </figure></p>
                        <p style="font-size:150%; color: black; line-height:130%" class="align-distribute">

                            <span class="tab"></span>Apparantly, a traffic jam occurs at the south-east of the figure. This is because the sensitiviy is too small, which mean drivers need more time to react. This results implies that Bando's model can qualitatively reproduce jamming transition of a trffic system with a extremely simple modle, and one crucial factor for jamming transition is human's reaction time. If you are interested, you can try to save figures at different time step and make a movie to see how a traffic jam happens. The final result is shown in the following vedio. Interestingly, you can see some oscillation beform jamming. That is because drivers try to accelerate and decelerate constantly at that time, and the reason is that, again, the reaction is too long such that all drives do not have enough time to react.
                        </p>
			<center>
			<video width="480" height="320" controls autoplay>
                            <source src="./Traffic/bandovideo.mp4" type="video/mp4">
                        </video>
			</center>
                    </div>

                </div>
            </div>
	    
        </section><!-- /.section-features -->










    </main><!-- /#main -->

    <footer id="colophon" class="site-footer">
        <div class="container">
            <div class="row">
                <div class="col-md-3 col-sm-4 col-xs-6">
                    <a class="site-title"><span>EJ </span> - A Complex System Researcher</a>
                    <p>I focus on nonlinear dynamics and pattern formation in live systems</p>
                    <p>I love reading Japanese books, and Japanese animate. Some reviews relating to my favorite books
                        are in progress </p>
                </div>
                <div class="col-lg-offset-4 col-md-3 col-sm-4 col-md-offset-2 col-sm-offset-0 col-xs-6 ">
                    <h3>Keep in touch</h3>
                    <ul class="list-unstyled contact-links">
                        <li><i class="fa fa-envelope" aria-hidden="true"></i><a
                                href="mailto:sim108022503@gapp.nthu.edu.tw">sim108022503@gapp.nthu.edu.tw</a></li>
                        <li><i class="fa fa-envelope" aria-hidden="true"></i><a
                                href="mailto:yichieh_lai@mx.nthu.edu.tw">yichieh_lai@mx.nthu.edu.tw</a></li>
                    </ul>
                </div>
                <div class="clearfix visible-xs"></div>
            </div>
        </div>
        <div class="copyright">
            <div class="container">
                <div class="row">
                    <div class="col-xs-8">
                        <div class="social-links">
                            <a class="github-bg" href="https://github.com/sim070500" target="_blank"><i
                                    class="fa fa-github"></i></a>
                        </div><!-- /.social-links -->
                    </div>
                    <div class="col-xs-4">
                        <div class="text-right">
                            <p>&copy; AgencyPerfect</p>
                            <p>All Rights Reserved</p>
                        </div>
                    </div>
                </div>
            </div>
        </div><!-- /.copyright -->
    </footer><!-- /#footer -->



    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/bootstrap-select.min.js"></script>
    <script src="assets/js/jquery.slicknav.min.js"></script>
    <script src="assets/js/jquery.countTo.min.js"></script>
    <script src="assets/js/jquery.shuffle.min.js"></script>
    <script src="assets/js/script.js"></script>

</body>

</html>
